# This is a Bazel genrule script. It acts like Bash, but has some extra
# substitutions for locating dependencies.
#
# https://docs.bazel.build/versions/master/be/general.html#genrule

cat "$(location :opentracing_compiler_flags)"
source "$(location :opentracing_compiler_flags)"

SOURCE_DIR=`dirname "$${PWD}/$(location :CMakeLists.txt)"`
mkdir -p "$(@D)/build"
cd "$(@D)/build"
CC=""
cmake  \
  -DCMAKE_BUILD_TYPE=Release \
  -DCMAKE_INSTALL_PREFIX="$${PWD}/../_prefix" \
  -DBUILD_TESTING=OFF \
  "$${SOURCE_DIR}"
make V=1 install
